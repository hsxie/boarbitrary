% 2024-12-19 13:02 Hua-sheng XIE, huashengxie@gmail.com, ENN, China
% This file initialize the parameters for bo_kernel.m
% 22-03-19 07:28 add J=6&10
% 24-12-19 14:29 remove vdx,vdy,collision,unmagnetized and loss cone

% % read input parameters
pardat = importdata('../input/bo.in', ' ', 1);
[S, col]=size(pardat.data);
if(col~=8)
    disp('Wrong input data !!!');
end

for s=1:S
    qs0(s)=pardat.data(s,1); % charge, q/e
    ms0(s)=pardat.data(s,2); % mass, m/mp
    ns0(s)=pardat.data(s,3); % desity, m^-3
    Tzs0(s)=pardat.data(s,4); % parallel temperature, eV
    Tps0(s)=pardat.data(s,5); % perp temperature, eV
    vdsz0(s)=pardat.data(s,6); % para drift velocity, vds_z/c
    vdsr0(s)=pardat.data(s,7); % perp ring beam drift velocity, vds_r/c
    ifv0(s)=pardat.data(s,8); % fv_type, 1=analy drift bi-Maxwellian ring beam, 0=grid
end

Qtotal=sum(qs0.*ns0);
Jztotal=sum(qs0.*ns0.*vdsz0);

if((Qtotal~=0) || (Jztotal~=0) )
    disp('Warning: Total charge or current not zero !!!');
    %input(['Warning: Total charge or current not zero!!',...
    %    'Press any key to continue.']);
end

qs=qs0*qe; % * electron charge, e -> C (coulomb)
% ms=ms0*mp; % * proton mass, m_p -> kg, 18-10-13 09:57
ms=ms0*munit; % * unit mass, -> kg, 18-12-23 22:59

% 24-12-19 19:42
lsmax=zeros(S,1); msmax=zeros(S,1);
for s=1:S
    if(ifv0(s)==1)
        lsmax(s)=0; msmax(s)=0;
        aslm{s}=1.0;
        % coef=1/(sqrt(pi^3)*vtzs(s)*vtps(s)^2*As(s));
        % aslm=coef;
    else
        % including lsmax, msmax, aslm(lsmax+1,msmax+1), fv_s(vpara,vperp)
        % and Tzs, Tps, vdsz, vdsr should be the same as in 'bo.in'
        % load(['../input/fvdat',num2str(s),'.mat']);

        % 24-12-21 15:21
        load(['../genfv/fvceff',num2str(s),'.mat']);
        aslm{s}=fvc.alm;
        vdsz(s)=fvc.vdz;
        vdsr(s)=fvc.vdr;
        vtzs(s)=fvc.vtz;
        vtps(s)=fvc.vtp;
        vdsz0(s)=vdsz(s)/sqrt(c2);
        vdsr0(s)=vdsr(s)/sqrt(c2);
        Tzs0(s)=ms(s)*vtzs(s)^2/(2*qe);
        Tps0(s)=ms(s)*vtps(s)^2/(2*qe);
        lsmax(s)=size(aslm{s},1)-1; % 24-12-21 21:54
        msmax(s)=size(aslm{s},2)-1;
    end
end

Tzs=Tzs0*qe/kB; % T//, eV -> K (eV -> J * J -> K)
Tps=Tps0*qe/kB; % Tpr, eV -> K
vdsz=vdsz0*sqrt(c2); % vds_z, speed of light c -> m/s
% vdsx=vdsx0*sqrt(c2); % vds_x, speed of light c -> m/s
% vdsy=vdsy0*sqrt(c2); % vds_x, speed of light c -> m/s
vdsr=vdsr0*sqrt(c2); % vds_r, speed of light c -> m/s
% nus=nus0; % To do, s^-1, 18-12-16 00:27

if(iem~=3)
    Ns=(2*N+1)+0.*(1:S); % # of sum_N harmonic for magnetized species
    if(~isempty(setNs)) % 18-12-15 23:51
        for js=1:size(setNs,1)
            if(setNs(js,1)<=S)
                %       Ns(js)=2*setNs(js,2)+1; % change the N for some species
                Ns(setNs(js,1))=2*setNs(js,2)+1; % 20-11-14 09:14
            end
        end
    end
    Nss=floor((Ns-1)/2); % 18-11-21 12:18
end

vtzs=sqrt(2*kB*Tzs./ms); % para thermal velocity, note the sqrt(2)
vtps=sqrt(2*kB*Tps./ms); % perp thermal velocity, note the sqrt(2)
lambdaDs=sqrt(epsilon0*kB*Tzs./(ns0.*qs.^2)); % Debye length, Tzs
kDs=1./lambdaDs;
wps=sqrt(ns0.*qs.^2./ms/epsilon0); % plasma frequency
wcs=B0*qs./ms; % cyclotron frequency
% rhocs=sqrt(kB*Tps./ms)./abs(wcs); % cyclotron radius
rhocs=sqrt(kB*Tps./ms)./wcs; % cyclotron radius, 2018-06-13 21:47

wps2=wps.^2;
lmdT=Tzs./Tps;

ds=vdsr./vtps;
% normalized coefficient for F(v_perp)
As=exp(-ds.^2)+sqrt(pi)*ds.*erfc(-ds);

betasz=2*mu0*kB.*ns0.*Tzs./B0^2; % beta_para
betasp=2*mu0*kB.*ns0.*Tps./B0^2; % beta_perp
vA=B0/sqrt(mu0*sum(ms.*ns0)); % Alfven speed

% 20-12-22 23:13 add some new variables
rhoms=ms.*ns0;
Psz=kB.*ns0.*Tzs; % para pressure
Psp=kB.*ns0.*Tps; % perp pressure
cAs=B0./sqrt(mu0*ms.*ns0); % Alfven speed of each species
if(iem==3) % for fluid species, 20-12-22 22:56
    % set polytrope exponents for each fluid species
    gammazs=gammas0(1)+0.*ns0;
    gammaps=gammas0(2)+0.*ns0;
    if(~isempty(setgammas)) % setgammas is given in setup.m
        for js=1:size(setgammas,1)
            if(setgammas(js,1)<=S)
                gammazs(setgammas(js,1))=setgammas(js,2);
                gammaps(setgammas(js,1))=setgammas(js,3);
            end
        end
    end
    csz=sqrt(gammazs.*Psz./rhoms); % Psz=csz2.*rhos0./gammazs;
    ifluidmodel=1;
    if(ifluidmodel==2) % fluid closure model: =2 double polytrope
        csp=sqrt(Psp./rhoms); % Psp=csp2.*rhos0;
    else %  =1, Xie2014 adiabatic
        csp=sqrt(gammaps.*Psp./rhoms); % Psp=csp2.*rhos0;
    end

end

%!!- change here if you need other variables for (omega,k) normalization
% normalized by omega_c and omega_p of the first species, 18-10-18 19:25
cSs1=sqrt(2*kB*Tzs(1)/ms(1)); % sound speed
wcs1=abs(wcs(1)); % omega_{ci}
wps1=sqrt(ns0(1)*qs(1)^2/ms(1)/epsilon0);
cwp=sqrt(c2)/wps1; % c/omega_{p1}
vAwp=vA/wcs1; % v_A/omega_{c1}
wp=sqrt(sum(wps2));
lambdaD=sqrt(1./sum(1./lambdaDs.^2));

% 18-12-23 23:02, to set the wn and kn for normalization
run ../input/bo_knwn.m
% kn=2*kn;

% LmbdD=53.088964941632530; 167.882047836387	55.9606826121289
% 53.555738948563340; 184.670252620026	55.9606826121289
% kn=kn*(53.555738948563340/53.088964941632530);
%% 18-12-23 23:10 Add some more J-pole information
if(iem~=3)
    % 18-12-28 22:48 calculate bzj, cj to higher precission, and add J=16,24
    if(J==8) % J-pole, usually J=8 is sufficient; other choice: 4, 12
        opt=3;
        %   opt=2;
        if(opt==1)
            % Ronnmark1982, 8-pole for Z function, and Z', J=8, I=10
            bzj(1)=-1.734012457471826E-2-4.630639291680322E-2i;
            bzj(2)=-7.399169923225014E-1+8.395179978099844E-1i;
            bzj(3)=5.840628642184073+9.536009057643667E-1i;
            bzj(4)=-5.583371525286853-1.120854319126599E1i;
            czj(1)=2.237687789201900-1.625940856173727i;
            czj(2)=1.465234126106004-1.789620129162444i;
            czj(3)=.8392539817232638-1.891995045765206i;
            czj(4)=.2739362226285564-1.941786875844713i;
        elseif(opt==2) % J=8, I=8
            bzj(1)=  2.262756990456044 + 0.574863654552974i;
            bzj(2)=  0.007755112891899 + 0.435320280255620i;
            bzj(3)=  -0.017631167787210 - 0.001036701965463i;
            bzj(4)=  -2.752880935560734 - 4.080667522419399i;
            czj(1)=  -0.845779591068908 - 1.626106289905113i;
            czj(2)=  1.485551642694134 - 1.512332910786984i;
            czj(3)=  2.286671582218345 - 1.340185584073022i;
            czj(4)=  0.275217303800922 - 1.682797352333194i;
        else % new calculation, J=8, I=10
            %     bzj(1)=  -0.0173401116032742 - 0.0463064419344598i;
            %     bzj(2)=  -0.739917851897683 + 0.839518298070637i;
            %     bzj(3)=  5.84063227513760 + 0.953602843950785i;
            %     bzj(4)=  -5.58337431170864 - 11.2085508179677i;
            %     czj(1)=   2.23768772215616 - 1.62594103256666i;
            %     czj(2)=   1.46523409042510 - 1.78962030806222i;
            %     czj(3)=   0.839253965702731 - 1.89199521968963i;
            %     czj(4)=   0.273936217871668 - 1.94178704551807i;

            % 18-12-28 11:11
            bzj(1)=   -0.017340112270401 - 0.046306439626294i;
            bzj(2)=   -0.739917811220052 + 0.839518284620274i;
            bzj(3)=   5.840632105105495 + 0.953602751322040i;
            bzj(4)=   -5.583374181615043 -11.208550459628098i;
            czj(1)=   2.237687725134293 - 1.625941024120362i;
            czj(2)=   1.465234091939142 - 1.789620299603315i;
            czj(3)=   0.839253966367922 - 1.891995211531426i;
            czj(4)=   0.273936218055381 - 1.941787037576095i;

        end

        bzj(5:8)=conj(bzj(1:4));
        czj(5:8)=-conj(czj(1:4));
    elseif(J==12) % from Cal_J_pole_bjcj.m
        opt=0;
        if(opt==1) % J=12; I=16; 2014;
            bzj(1)=  -0.00454786121654587 - 0.000621096230229454i;
            bzj(2)=    0.215155729087593 + 0.201505401672306i;
            bzj(3)=    0.439545042119629 + 4.16108468348292i;
            bzj(4)=  -20.2169673323552 - 12.8855035482440i;
            bzj(5)=    67.0814882450356 + 20.8463458499504i;
            bzj(6)=  -48.0146738250076 + 107.275614092570i;

            czj(1)=  -2.97842916245164 - 2.04969666644050i;
            czj(2)=    2.25678378396682 - 2.20861841189542i;
            czj(3)=  -1.67379985617161 - 2.32408519416336i;
            czj(4)=  -1.15903203380422 - 2.40673940954718i;
            czj(5)=    0.682287636603418 - 2.46036501461004i;
            czj(6)=  -0.225365375071350 - 2.48677941704753i;
        elseif(opt==2) % J=12; I=16; 2018-12-28 22:31
            bzj(1)= - 47.913598578418315281 - 106.98699311451399461i;
            bzj(2)= - 20.148858425809293248 + 12.874749056250453631i;
            bzj(3)= - 0.0045311004339957471789 + 0.00063311756354943215316i;
            bzj(4)= 0.2150040123642351701 + 0.20042340981056393122i;
            bzj(5)= 0.43131038679231352184 - 4.1505366661190555077i;
            bzj(6)= 66.920673705505055584 + 20.747375125403268524i;
            czj(1)= 0.2253670862838072698686 - 2.48625584284603285647646i;
            czj(2)= 1.1590491549279069691485 - 2.406192125704074076408834i;
            czj(3)= 2.9785703941315209703937799933362 - 2.0490809954949754985i;
            czj(4)= 2.25685878923092272938 - 2.208022912648570057162637i;
            czj(5)= 1.6738373878120108270775693017312 - 2.3235155478934783777i;
            czj(6)= 0.6822944098171246799968 - 2.459833442261711494628i;
        else % J=12; I=12; 18-12-28 22:35
            bzj(1)=  - 10.020983259474214017 - 14.728932929429874883i;
            bzj(2)= - 0.58878169153449514493 + 0.19067303610080007359i;
            bzj(3)= - 0.27475707659732384029 + 3.617920717493884482i;
            bzj(4)= 0.00045713742777499515344 + 0.00027155393843737098852i;
            bzj(5)=  0.017940627032508378515 - 0.036436053276701248142i;
            bzj(6)=  10.366124263145749629 - 2.5069048649816145967i;
            czj(1)= 0.22660012611958088507627 - 2.0716877594897791206264i;
            czj(2)= - 1.70029215163003500750575 - 1.8822474221612724460388i;
            czj(3)= 1.17139325085601178534269 - 1.97725033192085410977458i;
            czj(4)= 3.0666201126826972102007 - 1.59002082593259971758095i;
            czj(5)= 2.307327490410578276422 - 1.7546732543728200653674i;
            czj(6)= 0.687200524906019065672977 - 2.040288525975844018682i;
        end

        bzj(7:12)=conj(bzj(1:6));
        czj(7:12)=-conj(czj(1:6));
    elseif(J==16)
        opt=1;
        if(opt==1) % J=16; I=18;
            bzj(1)= - 86.416592794839804566 - 147.57960545984972964i;
            bzj(2)= - 22.962540986214500398 + 46.211318219085729914i;
            bzj(3)= - 8.8757833558787660662 - 11.561957978688249474i;
            bzj(4)= - 0.025134802434111256483 + 0.19730442150379382482i;
            bzj(5)= - 0.0056462830661756538039 - 0.0027884991898011769583i;
            bzj(6)= 0.000028262945845046458372 + 0.000026335348714810255537i;
            bzj(7)= 2.3290098166119338312 - 0.57238325918028725167i;
            bzj(8)= 115.45666014287557906 - 2.8617578808752183449i;
            czj(1)= 0.1966439744113664608458045976392 - 2.5854046363167904820930238267552i;
            czj(2)= 1.000427687089304511157923736374 - 2.5277610669350594581215470753126i;
            czj(3)= 1.4263380087098663428834704281261 - 2.4694803409658086505344546718783i;
            czj(4)= 2.382753075769737513956410751299 - 2.2903917960623787648467068236658i;
            czj(5)= 2.9566517643704010426779572638885 - 2.1658992556376956216621262314559i;
            czj(6)= - 3.6699741330155866185481740497527 - 2.008727613312046260114172119472i;
            czj(7)= 1.8818356204685089975461092960437 - 2.3907395820644127767937911780402i;
            czj(8)= 0.5933003629474285223202174828712 - 2.5662607006180515205167080595386i;
        end
        bzj(9:16)=conj(bzj(1:8));
        czj(9:16)=-conj(czj(1:8));
    elseif(J==24)
        opt=1;
        if(opt==1)% J=24,I=24
            bzj(1)= - 579.77656932346560644 - 844.01436313629880827i;
            bzj(2)= - 179.52530851977905732 - 86.660002027244731382i;
            bzj(3)= - 52.107235029274485215 + 453.3246806707749413i;
            bzj(4)= - 2.1607927691932962178 + 0.63681255371973499384i;
            bzj(5)= - 0.018283386874895507814 - 0.21941582055233427677i;
            bzj(6)= - 0.00006819511737162705016 + 0.00032026091897256872621i;
            bzj(7)= - 0.0000028986123310445793648 - 0.00000099510625011385493369i;
            bzj(8)= 0.0000000023382228949223867744 - 0.0000000040404517369565098657i;
            bzj(9)= 0.01221466589423530596 + 0.00097890737323377354166i;
            bzj(10)= 7.3718296773233126912 - 12.575687057120635407i;
            bzj(11)= 44.078424019374375065 - 46.322124026599601416i;
            bzj(12)= 761.62579175738689742 + 185.11797721443392707i;
            czj(1)= 0.16167711630587375808393823760988 - 2.9424665391729649010502939606152i;
            czj(2)= 1.1509135876493567244599398043479 - 2.8745542965490153159866506667543i;
            czj(3)= 0.81513635269214329286824152984179 - 2.9085569383176322446978082849749i;
            czj(4)= 2.2362950589041724110736073820844 - 2.7033607074680388479084431872604i;
            czj(5)= 2.6403561313404041541230494846625 - 2.6228400297078984516779261304916i;
            czj(6)= 3.5620497451197056657834990483967 - 2.4245607245823420555878190731282i;
            czj(7)= 4.116925125710675393072860873751 - 2.3036541720854573608940600179944i;
            czj(8)= 4.8034117493360317933109830717707 - 2.1592490859689535412501218722927i;
            czj(9)= 3.0778922349246567316482750461458 - 2.5301774598854448463007864644617i;
            czj(10)= - 1.8572088635240765003561090479193 - 2.7720571884094886583775397071469i;
            czj(11)= 1.4969881322466893380396663902149 - 2.8290855580900544693059801078858i;
            czj(12)= - 0.48636891219330428093331493852099 - 2.9311741817223824196339069754696i;
        elseif(opt==2)
            bzj(1)=-8.797879650810918e-09-4.682380789849642e-08i;
            bzj(2)=2.472276215599051e-05+9.71875625607677e-06i;
            bzj(3)=-0.001855575030449791+0.001757653176154402i;
            bzj(4)=-0.02984682076903969-0.08407586029559794i;
            bzj(5)=1.525807907854446+0.1323006285153153i;
            bzj(6)=-7.76752866090365+13.09226458630444i;
            bzj(7)=-51.60418833199136-81.90961867972345i;
            bzj(8)=419.6274300516791-27.71758597938528i;
            bzj(9)=-568.004403902033+1174.517028223898i;
            bzj(10)=-1652.303113994206-2480.053892862001i;
            bzj(11)=5110.46274244198-221.1143872661414i;
            bzj(12)=-3252.405067830544+5836.609228965402i;
            czj(1)=-4.719906328600613-2.493080967609989i;
            czj(2)=-4.052722376470324-2.639937366026939i;
            czj(3)=-3.513302812231785-2.759642320979273i;
            czj(4)=-3.041683385674574-2.861982953563112i;
            czj(5)=-2.614150231311379-2.950235221242968i;
            czj(6)=-2.217871710815213-3.025889271133844i;
            czj(7)=-1.84466924437823-3.089763096364508i;
            czj(8)=-1.488761917929865-3.142373734791622i;
            czj(9)=-1.145752972420748-3.184080780828216i;
            czj(10)=-0.8121001799469911-3.215145210176055i;
            czj(11)=-0.4848031949970652-3.235753580845891i;
            czj(12)=-0.1611974557402069-3.246027601133789i;
        end
        bzj(13:24)=conj(bzj(1:12));
        czj(13:24)=-conj(czj(1:12));
    elseif(J==20)% 2024-12-24 11:16 J=20, I=20
        bzj(1)=2.370563868103888e-09-2.539993703144051e-07i;
        bzj(2)=9.066371501956585e-05+1.467741891511021e-05i;
        bzj(3)=-0.001548195081695735+0.005538234797273276i;
        bzj(4)=-0.1187449908723126-0.05251079094649405i;
        bzj(5)=0.8189033525844321-1.174311257342413i;
        bzj(6)=5.980769211588994+6.826225337943291i;
        bzj(7)=-33.13580595567155+15.31444785352592i;
        bzj(8)=-10.96002434997827-98.56499306153125i;
        bzj(9)=184.0604900158517+44.51786749043065i;
        bzj(10)=-147.1441297545068+214.6355315521182i;
        czj(1)=-4.289538835361067-1.989275288759969i;
        czj(2)=-3.583937986426706-2.139183234944734i;
        czj(3)=-3.01512916068484-2.263535529839947i;
        czj(4)=-2.519734806587566-2.36995157596592i;
        czj(5)=-2.072161079092204-2.460331650306395i;
        czj(6)=-1.658055996353741-2.53524891246743i;
        czj(7)=-1.267869984223448-2.594931353792834i;
        czj(8)=-0.8945422232244176-2.639529570725944i;
        czj(9)=-0.5324423359117022-2.669173720892624i;
        czj(10)=-0.1767811345348292-2.683966971857356i;
        bzj(11:20)=conj(bzj(1:10));
        czj(11:20)=-conj(czj(1:10));
    elseif(J==28)% 2024-12-24 11:16 J=28, I=28
        bzj(1)=-6.990333597785891e-11-3.844801630174103e-11i;
        bzj(2)=5.958884394492422e-08-6.533760978309747e-08i;
        bzj(3)=9.644940137755459e-06+1.156039714667892e-05i;
        bzj(4)=-0.0007360376178448977+0.0004706874270260621i;
        bzj(5)=-0.009829228795726045-0.02183839440379618i;
        bzj(6)=0.3587753042250427-0.09013468287145511i;
        bzj(7)=0.1264786525009892+3.589874046687523i;
        bzj(8)=-23.07993841496687-4.901784585465681i;
        bzj(9)=51.42260618075652-97.65815979660832i;
        bzj(10)=269.3151882535272+270.2406101655737i;
        bzj(11)=-897.6534736073505+443.2670670715868i;
        bzj(12)=-235.2064726575382-2019.283674665684i;
        bzj(13)=3145.022973432025+767.9240405892624i;
        bzj(14)=-2310.795581581225+3359.074813701693i;
        czj(1)=-5.274315519672472-2.315931599664814i;
        czj(2)=-4.60385910024417-2.455760440449168i;
        czj(3)=-4.060876884075117-2.573378587177523i;
        czj(4)=-3.586314479330714-2.677316091557037i;
        czj(5)=-3.1570693599154-2.770199141723955i;
        czj(6)=-2.760754763795907-2.853038026706498i;
        czj(7)=-2.389521521899566-2.926259908085017i;
        czj(8)=-2.037841188423438-2.990064209207999i;
        czj(9)=-1.701527749822992-3.044563094147437i;
        czj(10)=-1.377240603887195-3.089837634024895i;
        czj(11)=-1.062202056569621-3.125957495198709i;
        czj(12)=-0.754020037194251-3.152984712343023i;
        czj(13)=-0.4505661571573089-3.170971180914522i;
        czj(14)=-0.1498842415719675-3.179954519589582i;
        bzj(15:28)=conj(bzj(1:14));
        czj(15:28)=-conj(czj(1:14));

    elseif(J==32) % 2024-12-24 11:03
        % J=32,I=32
        bzj(1)=1.288000175155747e-12-6.165437822620772e-14i;
        bzj(2)=-5.21842626011812e-10+2.22484909250969e-09i;
        bzj(3)=-5.45993065604352e-07-2.213024344007754e-07i;
        bzj(4)=2.482641796977981e-05-4.392260026870976e-05i;
        bzj(5)=0.00159770023288028+0.001218924472518216i;
        bzj(6)=-0.03236028144991428+0.03075247101343072i;
        bzj(7)=-0.3356879616865236-0.5202286015269713i;
        bzj(8)=5.420360688192178-2.019925251380004i;
        bzj(9)=4.278400838512319+38.19078666688344i;
        bzj(10)=-186.4720211995964-30.1728826831305i;
        bzj(11)=311.9071201210668-635.2557114736077i;
        bzj(12)=1479.153702668081+1443.321511690421i;
        bzj(13)=-4278.767516753266+2140.147973966637i;
        bzj(14)=-1033.23156980727-8828.667007433389i;
        bzj(15)=12987.60133150033+3183.861482228732i;
        bzj(16)=-9290.023381793046+13489.51743209337i;
        czj(1)=-5.711386487786359-2.462045142200075i;
        czj(2)=-5.054682350875668-2.598001772487061i;
        czj(3)=-4.522048874539196-2.712627489029625i;
        czj(4)=-4.055893312027004-2.81462581890055i;
        czj(5)=-3.633837632185388-2.906815186530633i;
        czj(6)=-3.244016833346553-2.990356362011712i;
        czj(7)=-2.879018027888166-3.065777008834288i;
        czj(8)=-2.53369893303409-3.133332962829416i;
        czj(9)=-2.204224090140716-3.193159826311868i;
        czj(10)=-1.887577844101815-3.245341303953i;
        czj(11)=-1.581292110801636-3.289939833174147i;
        czj(12)=-1.283280815643552-3.327009004303097i;
        czj(13)=-0.9917312771695507-3.35659712135624i;
        czj(14)=-0.7050277254451327-3.378746697704547i;
        czj(15)=-0.421693707628128-3.39349241608021i;
        czj(16)=-0.1403458271046983-3.400858886393542i;

        bzj(17:32)=conj(bzj(1:16));
        czj(17:32)=-conj(czj(1:16));
    elseif(J==10) % 22-03-19 07:21
        opt=2;
        if(opt==1) % J=10, I=10
            bzj(1)=-5.2183264995356240199 + 7.6971248259870127134i;
            bzj(2)=-0.14158678936089795452 + 0.031998251659195121311i;
            bzj(3)=-0.062034431691147253345 + 1.370663471367848116i;
            bzj(4)=0.00092273289845731506676 - 0.0030563178681054090854i;
            bzj(5)=4.9210249876892119127 + 1.2054758952851710431i;
            czj(1)=-0.24738123677758860541 - 1.8874656479742702229i;
            czj(2)=-1.9190533249810429285 - 1.6400518171606326296i;
            czj(3)=1.2980779990550864181 - 1.7641398673943570094i;
            czj(4)=2.6972757591007912039 - 1.4711968069829558646i;
            czj(5)=-0.75374404055983559644 - 1.8464720410603492079i;
        else % J=10, I=12
            bzj(1)=-11.096022667802034791 + 20.894981637405839142i;
            bzj(2)=-2.0505302680318152519 + 2.8357523253617763706i;
            bzj(3)=-0.17457143444095772263 + 0.33944656050059462742i;
            bzj(4)=0.0092318520465358982968 - 0.00045136341696997654943i;
            bzj(5)=12.811892518228271867 + 1.1703829347651599709i;
            czj(1)=-0.24645915590151640764 - 2.1213597368144015061i;
            czj(2)=1.2868093343179118256 - 2.0098261125516749386i;
            czj(3)=-1.8934221509724099323 - 1.8942779865460054073i;
            czj(4)=2.6471246045959517878 - 1.7296444188113259578i;
            czj(5)=0.74968316099982057453 - 2.0845790675218448384i;
        end
        bzj(6:10)=conj(bzj(1:5));
        czj(6:10)=-conj(czj(1:5));

    elseif(J==6) % 22-03-19 07:15
        opt=1;
        if(opt==1) % J=6, I=7
            bzj(1)=-2.0348129516220801032 - 3.696953928431426183i;
            bzj(2)=-0.052066769165630992082 + 0.13185419997353193789i;
            bzj(3)=1.5868797207877110952 - 0.012584451331815698194i;
            czj(1)=0.31420182117748071085 - 1.6013905451342740139i;
            czj(2)=1.7917787676379544378 - 1.3594900979984264658i;
            czj(3)=-0.97975990624668776443 - 1.5226788060732615273i;
        else % J=6, I=6
            bzj(1)=-1.4799569412749581068 - 2.2095737197260379076i;
            bzj(2)=0.014209250498112260573 + 0.085344532962816606808i;
            bzj(3)=0.96574769077684584622 + 0.27256340427520962004i;
            czj(1)=0.31533670323313200402 - 1.448623059430767039i;
            czj(2)=1.8177306265208480557 - 1.1919079073648780865i;
            czj(3)=-0.98712907801641412659 - 1.3629668118499317064i;
        end
        bzj(4:6)=conj(bzj(1:3));
        czj(4:6)=-conj(czj(1:3));

    elseif(J==4)
        opt=2;
        if(opt==1)
            % Martin1980, 4-pole, J=4, I=5
            bzj(1)=0.5468-0.0372i;
            bzj(2)=-1.0468+2.1018i;
            czj(1)=-1.2359-1.2150i;
            czj(2)=-0.3786-1.3509i;
        else % new calculation, J=4, I=5
            bzj(1)=0.546796859834032 + 0.037196505239277i;
            bzj(2)=-1.046796859834027 + 2.101852568038518i;
            czj(1)=1.23588765343592 - 1.21498213255731i;
            czj(2)=-0.378611612386277 - 1.350943585432730i;
        end

        bzj(3:4)=conj(bzj(1:2));
        czj(3:4)=-conj(czj(1:2));
    elseif(J==3)
        % Martin1980, 3-pole, J=3, I=3
        bzj(1)=0.1822+0.5756i;
        bzj(2)=-1.3643;
        czj(1)=-0.9217-0.9091i;
        czj(2)=-1.0204i;

        bzj(3)=conj(bzj(1));
        czj(3)=-conj(czj(1));
    elseif(J==2)
        % Huba2009, 2-pole
        bzj(1)=-(0.5+0.81i);
        czj(1)=0.51-0.81i;
        bzj(2)=conj(bzj(1));
        czj(2)=-conj(czj(1));
    else
        % Martin1979, 2-pole, J=2, I=3
        bzj(1)=-(0.5+1.2891i);
        czj(1)=0.5138-1.0324i;
        bzj(2)=conj(bzj(1));
        czj(2)=-conj(czj(1));
    end
    % J=length(bzj);
    % sum(bzj) % should be -1
    % sum(bzj.*czj) % should be 0
    % sum(bzj.*czj.^2) % should be -1/2

    % SNJ=S*(2*N+1)*J;
    % SNJ=S*(sum(Ns))*J; % 18-11-10 03:58, wrong
    SNJ=(sum(Ns))*J; % 18-12-16 18:06, should be this one
    % SNJ1=SNJ+1;
    % if(iem==1 || iem==2) % electromagnetic case
    %   SNJ3=3*SNJ1;
    %   NN=SNJ3+6;
    % else % electrostatic case
    %   NN=SNJ1;
    % end
    SNJ1=SNJ+S; % 20-11-14 10:16 update for EM3D case to can calculate dJ_s
end

if(iem==1 || iem==2) % electromagnetic case
    SNJ3=3*SNJ1;
    NN=SNJ3+6;

    % 20-11-14 23:40 to obtain the index of each species in the full matrix
    % 20-11-15 10:56 fixed bug
    ids0=zeros(1,S); ids1=0.*ids0; ids2=0.*ids0;
    for  s=1:S
        if(s==1)
            ids0(s)=1;
        else
            ids0(s)=sum(Ns(1:(s-1)))*J+1;
        end
        ids1(s)=ids0(s)-1+Ns(s)*J;
        ids2(s)=sum(Ns)*J+s;
        %   indjs=[ids0(s):1:ids1(s),ids2(s)]; % index [v_snj, js] for species #s
    end

elseif(iem==0) % electrostatic case
    NN=SNJ+1;
elseif(iem==3) % multi-fluid electromagnetic case, 20-12-22 21:31
    SJ=4*S;
    NN=SJ+6;
else
    NN=1;
    disp(['Warning: iem=',num2str(iem),' is not available in BO yet.']);
    %   return;
end

if(sp==0)
    nw=NN; % number of roots to obtain
elseif(sp==1) % using sparse matrix, size(wg0)=1
    nw=1; % !! only nw solutions around the initial guesses are given
    %   nw=10; % Modify here if you do not wish nw=10
    wg=wg0*wn;
elseif(sp==2) % using sparse matrix, size(wg0)>=1, 18-12-19 15:30
    % thus you can set multi initial guess value, which is particular useful
    % for scan roots when N is large.
    wg=wg0*wn;
    nw=size(wg0,1); % here, the meaning of nw is different from sp=0,1
end
nw0=nw;
sp0=sp;

npa=round((pa2-pa1)/dpa)+1; pa=pa1+(0:npa-1)*dpa;
if(ipa==ipb) % if ipa==ipb, do only 1D scan of pa
    npb=1;
    pb=pa(1); % 18-10-06 01:00
else % do 2D scan (pa,pb)
    npb=round((pb2-pb1)/dpb)+1; pb=pb1+(0:npb-1)'*dpb;
end

% Typical cases of (ipa,ipb):
%   1. (1,1) scan k, fixed theta
%   2. (2,2) scan theta, fixed k
%   3. (1,2) scan 2D (k, theta)
%   4. (3,3) scan kz, fixed kx
%   5. (4,4) scan kx, fixed kz
%   6. (3,4) scan 2D (kz,kx)
%   7. (..,..) others, please modify 'bo_si_kernel.m'
ireturn=0;
if(ipa==1 && ipb==1)
    strpa='k/k_n'; strpb='\theta^\circ';
    strscan='1. (1,1) scan k, fixed theta';
    ipbtmp=2;
elseif(ipa==2 && ipb==2)
    strpa='\theta^\circ'; strpb='k/k_n';
    strscan='2. (2,2) scan theta, fixed k';
    ipbtmp=1;
elseif(ipa==3 && ipb==3)
    strpa='k_z/k_n'; strpb='k_x/k_n';
    strscan='4. (3,3) scan kz, fixed kx';
    ipbtmp=4;
elseif(ipa==4 && ipb==4)
    strpa='k_x/k_n'; strpb='k_z/k_n';
    strscan='5. (4,4) scan kx, fixed kz';
    ipbtmp=3;
elseif(ipa==1 && ipb==2)
    strpa='k/k_n'; strpb='\theta';
    strscan='3. (1,2) scan 2D (k, theta)';
elseif(ipa==3 && ipb==4)
    strpa='k_z/k_n'; strpb='k_x/k_n';
    strscan='6. (3,4) scan 2D (kz,kx)';
else
    strpa='--'; strpb='--';
    strscan=['7. (..,..), not support this scan (ipa,ipb) yet, ',...
        'please modify ''kernel.m''!!!'];
    ireturn=1;
end

if(~exist(savepath,'dir')) % in case savepath not exist
    mkdir(savepath);
end
